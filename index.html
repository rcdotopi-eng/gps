<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GPS Test ‚Äì Fixed</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#f4f6f9; padding:20px; }
.card { background:#fff; padding:20px; border-radius:10px; max-width:420px; margin:auto; }
button { width:100%; padding:14px; margin-top:10px; font-size:16px; border:none; border-radius:8px; }
.btn { background:#007bff; color:white; }
.btn-green { background:#28a745; color:white; }
p { font-size:14px; }
</style>
</head>

<body>

<div class="card">
  <h2>üöó Driver GPS Test</h2>

  <p>Driver Lat: <b id="dlat">-</b></p>
  <p>Driver Lng: <b id="dlng">-</b></p>

  <p>Rider Lat: <b>31.5204</b></p>
  <p>Rider Lng: <b>74.3587</b></p>

  <p>Distance: <b id="distance">-</b> km</p>

  <button id="btn-gps" class="btn">üìç Get My Location</button>
  <button id="btn-nav" class="btn-green">üß≠ Open Navigation</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  let driverLat = null;
  let driverLng = null;

  const riderLat = 31.5204;
  const riderLng = 74.3587;

  const btnGps = document.getElementById("btn-gps");
  const btnNav = document.getElementById("btn-nav");

  btnGps.addEventListener("click", () => {
    if (!navigator.geolocation) {
      alert("Geolocation not supported");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        driverLat = pos.coords.latitude;
        driverLng = pos.coords.longitude;

        document.getElementById("dlat").innerText = driverLat.toFixed(6);
        document.getElementById("dlng").innerText = driverLng.toFixed(6);

        const km = getDistanceKm(driverLat, driverLng, riderLat, riderLng);
        document.getElementById("distance").innerText = km;
      },
      (err) => {
        alert("GPS Error: " + err.message);
      },
      { enableHighAccuracy: true }
    );
  });

  btnNav.addEventListener("click", () => {
    if (driverLat === null) {
      alert("Get GPS first");
      return;
    }

    const url = `https://www.google.com/maps/dir/?api=1&origin=${driverLat},${driverLng}&destination=${riderLat},${riderLng}`;
    window.open(url, "_blank");
  });

  function getDistanceKm(lat1, lng1, lat2, lng2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a =
      Math.sin(dLat/2)**2 +
      Math.cos(lat1*Math.PI/180) *
      Math.cos(lat2*Math.PI/180) *
      Math.sin(dLng/2)**2;
    return (R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))).toFixed(2);
  }

});
</script>

</body>
</html>
